# Chapter 4: Build Systems

UnifyWeaver generates both Makefile and CMake configurations for C projects.

## Makefile Generation

```prolog
?- generate_makefile([program_name(my_filter)], Makefile).
```

Generated:
```makefile
# Generated by UnifyWeaver C Target
CC = gcc
CFLAGS = -Wall -Wextra -O2 -std=c11
LDFLAGS = -lcjson

TARGET = my_filter
SOURCES = pipeline.c cJSON.c

.PHONY: all clean

all: $(TARGET)

$(TARGET): $(SOURCES)
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

clean:
	rm -f $(TARGET)
```

## CMake Generation

```prolog
?- generate_cmake([project_name('MyFilter')], CMake).
```

Generated:
```cmake
# Generated by UnifyWeaver C Target
cmake_minimum_required(VERSION 3.10)
project(MyFilter C)

set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

add_executable(pipeline pipeline.c cJSON.c)
target_link_libraries(pipeline cjson)
```

## Installing cJSON

### Ubuntu/Debian
```bash
sudo apt install libcjson-dev
```

### macOS
```bash
brew install cjson
```

### From Source
```bash
git clone https://github.com/DaveGamble/cJSON.git
cd cJSON && mkdir build && cd build
cmake .. && make && sudo make install
```

## Building Your Pipeline

### With Makefile
```bash
make
./my_filter < input.jsonl
```

### With CMake
```bash
mkdir build && cd build
cmake ..
make
./pipeline < input.jsonl
```

## Complete Workflow

```prolog
% Generate everything
?- compile_predicate_to_c(filter/2, [pipeline_input(true)], Code),
   write_c_program(Code, 'filter.c').
?- generate_makefile([program_name(filter)], Make),
   write_to_file('Makefile', Make).
```

```bash
# Build and run
make
echo '{"value": 75}' | ./filter
```
