# Chapter 4: CMake Integration

UnifyWeaver generates CMake with FetchContent for automatic dependency management.

## CMake Generation

```prolog
?- generate_cmake_cpp([project_name('MyPipeline')], CMake).
```

Generated:
```cmake
# Generated by UnifyWeaver C++ Target
cmake_minimum_required(VERSION 3.14)
project(MyPipeline CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch nlohmann/json automatically
include(FetchContent)
FetchContent_Declare(
    json
    URL https://github.com/nlohmann/json/releases/download/v3.11.3/json.tar.xz
)
FetchContent_MakeAvailable(json)

add_executable(pipeline pipeline.cpp)
target_link_libraries(pipeline PRIVATE nlohmann_json::nlohmann_json)
```

## FetchContent

CMake's FetchContent downloads dependencies at configure time:

| Advantage | Description |
|-----------|-------------|
| No manual install | Dependencies downloaded automatically |
| Version pinned | Specific version guaranteed |
| Cross-platform | Works on Linux, macOS, Windows |

## Building Your Pipeline

```bash
# Configure
mkdir build && cd build
cmake ..

# Build
cmake --build .

# Run
./pipeline < input.jsonl
```

## Alternative: System Install

If you prefer system-installed nlohmann/json:

```cmake
# Instead of FetchContent:
find_package(nlohmann_json REQUIRED)
target_link_libraries(pipeline PRIVATE nlohmann_json::nlohmann_json)
```

### Installing nlohmann/json

**Ubuntu/Debian:**
```bash
sudo apt install nlohmann-json3-dev
```

**macOS:**
```bash
brew install nlohmann-json
```

## Complete Workflow

```prolog
% Generate everything
?- compile_predicate_to_cpp(filter/2, [pipeline_input(true)], Code),
   write_cpp_program(Code, 'filter.cpp').
?- generate_cmake_cpp([project_name('Filter')], CMake).
```

```bash
# Build and run
mkdir build && cd build
cmake .. && make
echo '{"value": 75}' | ./pipeline
```
